‏<!DOCTYPE html>
‏<html lang="ar">
‏<head>
‏  <meta charset="UTF-8">
‏  <title>🎬 أداة TikTok - عرض وتحميل الفيديوهات</title>
‏  <style>
‏    body {
‏      font-family: Arial, sans-serif;
‏      direction: rtl;
‏      background: #f0f0f0;
‏      margin: 0;
‏      padding: 30px;
‏      text-align: center;
    }
‏    input, button {
‏      width: 90%;
‏      max-width: 400px;
‏      padding: 12px;
‏      margin: 10px 0;
‏      font-size: 16px;
‏      border-radius: 6px;
‏      border: 1px solid #ccc;
    }
‏    button {
‏      background: #007bff;
‏      color: white;
‏      cursor: pointer;
‏      border: none;
    }
‏    button:hover {
‏      background: #0056b3;
    }
‏    #status {
‏      margin: 20px 0;
‏      font-weight: bold;
‏      color: #d00;
    }
‏    #videoContainer blockquote {
‏      margin: auto;
‏      max-width: 600px;
‏      min-width: 325px;
    }
‏    #downloadLink {
‏      display: none;
‏      margin-top: 15px;
    }
‏  </style>
‏</head>
‏<body>
‏  <h2>📲 عرض وتحميل فيديو TikTok</h2>

‏  <input type="text" id="tiktokInput" placeholder="ألصق رابط فيديو TikTok (حتى لو مختصر)">
‏  <br>
‏  <button onclick="handleInput()">عرض الفيديو</button>

‏  <div id="status"></div>
‏  <div id="videoContainer"></div>
‏  <a id="downloadLink" href="#" target="_blank" download>⬇️ تحميل الفيديو</a>

‏  <script>
‏    const UNSHORTEN_TOKEN = ' 7c0745c8698b3822502387854f32aa5dd8926306'; // توكن API

‏    async function unshortenLink(url) {
‏      const apiUrl = 'https://unshorten.me/api/v2/unshorten?url=' + encodeURIComponent(url);
‏      const res = await fetch(apiUrl, {
‏        method: 'GET',
‏        headers: {
‏          'Authorization': 'Token ' + UNSHORTEN_TOKEN
        }
      });
‏      if (!res.ok) throw new Error('فك الرابط فشل: ' + res.status);
‏      const data = await res.json();
‏      return data.success ? data["unshortened_url"] : null;
    }

‏    function extractVideoId(url) {
‏      const match = url.match(/video\/(\d{10,25})/);
‏      return match ? match[1] : null;
    }

‏    function getDownloadUrl(tiktokUrl) {
‏      return `https://ssstik.io/api/convert?url=${encodeURIComponent(tiktokUrl)}`;
    }

‏    async function handleInput() {
‏      const input = document.getElementById('tiktokInput').value.trim();
‏      const status = document.getElementById('status');
‏      const container = document.getElementById('videoContainer');
‏      const downloadLink = document.getElementById('downloadLink');

‏      status.textContent = '⏳ جاري المعالجة…';
‏      status.style.color = '#000';
‏      container.innerHTML = '';
‏      downloadLink.style.display = 'none';
‏      downloadLink.href = '#';

‏      if (!input) {
‏        status.textContent = '⚠️ الرجاء إدخال رابط TikTok.';
‏        status.style.color = 'red';
‏        return;
      }

‏      let fullUrl = input;
‏      try {
‏        if (input.includes('vt.tiktok.com') || input.includes('bit.ly') || input.includes('tinyurl.com')) {
‏          fullUrl = await unshortenLink(input);
‏          if (!fullUrl) throw new Error('فشل فك الرابط المختصر.');
        }

        // منع فيديوهات الصور أو الـ slideshow
‏        if (fullUrl.includes('/photo/') || fullUrl.includes('carousel')) {
‏          status.textContent = '⚠️ هذا النوع من الفيديوهات (صور فقط) لا يمكن تضمينه.';
‏          status.style.color = 'orange';
‏          return;
        }

‏        const id = extractVideoId(fullUrl);
‏        if (!id) throw new Error('الرجاء استخدام رابط يحتوي على video/ID.');

        // تضمين الفيديو
‏        const block = document.createElement('blockquote');
‏        block.className = 'tiktok-embed';
‏        block.setAttribute('cite', fullUrl);
‏        block.setAttribute('data-video-id', id);
‏        block.innerHTML = '<section>جاري تحميل الفيديو...</section>';
‏        container.appendChild(block);

‏        const oldScript = document.querySelector('#tiktok-script');
‏        if (oldScript) oldScript.remove();

‏        const script = document.createElement('script');
‏        script.src = 'https://www.tiktok.com/embed.js';
‏        script.async = true;
‏        script.id = 'tiktok-script';
‏        document.body.appendChild(script);

        // رابط تحميل تجريبي (غير رسمي، وقد لا يعمل مع كل الفيديوهات)
‏        const ssstikUrl = `https://ssstik.io/en?url=${encodeURIComponent(fullUrl)}`;
‏        downloadLink.href = ssstikUrl;
‏        downloadLink.style.display = 'inline-block';

‏        status.textContent = '✅ الفيديو ظاهر ويمكن تحميله أدناه 👇';
‏        status.style.color = 'green';

‏      } catch (err) {
‏        status.textContent = '❌ ' + err.message;
‏        status.style.color = 'red';
      }
    }
‏  </script>
‏</body>
‏</html>
